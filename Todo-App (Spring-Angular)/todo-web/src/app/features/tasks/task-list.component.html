<div class="space-y-6">
  <div class="grid gap-4 md:grid-cols-4">
    <div class="stat-card">
      <p class="stat-label">Tareas totales</p>
      <p class="stat-value">{{ stats.total }}</p>
      <p class="stat-hint">Incluye todas las tareas</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Abiertas</p>
      <p class="stat-value">{{ stats.open }}</p>
      <p class="stat-hint">Por atender</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Vencen hoy</p>
      <p class="stat-value">{{ stats.dueToday }}</p>
      <p class="stat-hint">Revisar pendientes</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Atrasadas</p>
      <p class="stat-value">{{ stats.overdue }}</p>
      <p class="stat-hint">Prioriza estas</p>
    </div>
  </div>

  <div class="list-card">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-1">
        <p class="eyebrow">Listado</p>
        <div class="flex flex-wrap items-center gap-3">
          <h2 class="text-2xl font-semibold text-black">Tareas</h2>
          <button mat-flat-button color="primary" type="button" class="btn-primary hidden md:inline-flex" (click)="openCreate()">
            <mat-icon>add</mat-icon>
            Nueva tarea
          </button>
        </div>
        <p class="text-sm text-black/70">Filtra y aplica acciones r√°pidas. Predeterminado: mostrar abiertas primero.</p>
      </div>
      <div class="flex flex-wrap gap-2 md:justify-end">
        <button mat-stroked-button type="button" class="btn-secondary" (click)="clearFilters()">
          Limpiar filtros
        </button>
        <button mat-flat-button color="primary" type="button" class="btn-primary md:hidden" (click)="openCreate()">
          <mat-icon>add</mat-icon>
          Nueva tarea
        </button>
      </div>
    </div>

    <div class="filters-bar">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar por t√≠tulo‚Ä¶</mat-label>
        <input
          matInput
          placeholder="Escribe y presiona Enter"
          [formControl]="filterForm.controls.search"
          (keyup.enter)="applyFilter()" />
        <button
          *ngIf="filterForm.value.search"
          matSuffix
          mat-icon-button
          aria-label="Limpiar b√∫squeda"
          (click)="clearFilter('search')">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="status-field">
        <mat-label>Estado</mat-label>
        <mat-select [formControl]="filterForm.controls.status" (selectionChange)="applyFilter()">
          <mat-option *ngFor="let option of statusOptions" [value]="option.value">{{ option.label }}</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-flat-button color="primary" class="btn-primary" type="button" (click)="applyFilter()">
        Aplicar filtros
      </button>
    </div>

    <div class="active-filters" *ngIf="activeFilters.length">
      <button
        *ngFor="let filter of activeFilters"
        type="button"
        class="filter-pill"
        (click)="clearFilter(filter.key)">
        <span>{{ filter.label }}</span>
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <ng-container *ngIf="loading">
      <div class="skeleton" *ngFor="let _ of skeletonRows"></div>
    </ng-container>

    <ng-container *ngIf="error && !loading">
      <div class="state-card error">
        <div class="state-icon">!</div>
        <div>
          <p class="state-title">No pudimos cargar las tareas</p>
          <p class="state-subtitle">Verifica tu conexi√≥n e int√©ntalo de nuevo.</p>
        </div>
        <button mat-flat-button color="primary" class="btn-primary" type="button" (click)="onRetry()">Reintentar</button>
      </div>
    </ng-container>

    <ng-container *ngIf="!loading && !error && !dataSource.data.length">
      <div class="state-card empty">
        <div class="state-icon">üóíÔ∏è</div>
        <div>
          <p class="state-title">A√∫n no tienes tareas creadas</p>
          <p class="state-subtitle">Organiza tu trabajo creando la primera.</p>
        </div>
        <button mat-flat-button color="primary" class="btn-primary" type="button" (click)="openCreate()">Crear primera tarea</button>
      </div>
    </ng-container>

    <ng-container *ngIf="!loading && !error && dataSource.data.length">
      <div class="hidden md:block">
        <div class="table-wrapper">
          <div class="table-scroller">
            <table mat-table [dataSource]="dataSource" matSort (matSortChange)="onSort($event)" class="sticky-header">
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>T√≠tulo</th>
              <td mat-cell *matCellDef="let task" class="font-medium text-black">{{ task.title }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
              <td mat-cell *matCellDef="let task">
                <span [ngClass]="statusClass(task.status)">
                  <span class="dot"></span>
                  {{ task.status }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="dueDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha l√≠mite</th>
              <td mat-cell *matCellDef="let task" class="text-black">
                {{ task.dueDate | date: 'mediumDate' : 'UTC' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="createdAt">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Creada</th>
              <td mat-cell *matCellDef="let task" class="text-black">
                {{ task.createdAt | date: 'short' : 'UTC' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let task" class="actions">
                <button
                  mat-icon-button
                  type="button"
                  class="action-btn edit"
                  (click)="openEdit(task)"
                  matTooltip="Editar tarea"
                  aria-label="Editar tarea">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  type="button"
                  class="action-btn delete"
                  (click)="confirmDelete(task)"
                  matTooltip="Eliminar tarea"
                  aria-label="Eliminar tarea">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>

          <div class="paginator">
            <mat-paginator
              [length]="totalElements"
              [pageSize]="pageSize"
              [pageIndex]="pageIndex"
              [pageSizeOptions]="[5, 10, 20]"
              (page)="onPage($event)">
            </mat-paginator>
          </div>
        </div>
      </div>

      <div class="grid gap-3 md:hidden">
        <div class="mobile-card" *ngFor="let task of dataSource.data">
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm uppercase tracking-wide text-black/60">T√≠tulo</p>
              <p class="text-base font-semibold text-black">{{ task.title }}</p>
            </div>
            <span [ngClass]="statusClass(task.status)">
              <span class="dot"></span>
              {{ task.status }}
            </span>
          </div>
          <div class="grid grid-cols-2 gap-2 text-sm text-black">
            <div>
              <p class="label">Fecha l√≠mite</p>
              <p>{{ task.dueDate | date: 'mediumDate' : 'UTC' }}</p>
            </div>
            <div>
              <p class="label">Creada</p>
              <p>{{ task.createdAt | date: 'short' : 'UTC' }}</p>
            </div>
          </div>
          <div class="flex justify-end gap-2 pt-2">
            <button
              mat-icon-button
              type="button"
              class="action-btn edit"
              (click)="openEdit(task)"
              matTooltip="Editar tarea"
              aria-label="Editar tarea">
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              type="button"
              class="action-btn delete"
              (click)="confirmDelete(task)"
              matTooltip="Eliminar tarea"
              aria-label="Eliminar tarea">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
